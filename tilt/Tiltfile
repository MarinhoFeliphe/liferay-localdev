update_settings(max_parallel_updates=1)

watch_file('/repo/k8s/endpoint/')
watch_file('/repo/k8s/extension_deployment/')
watch_file('/repo/k8s/extension_job/')

if config.tilt_subcommand == 'down':
  local('kubectl delete cm -l lxc.liferay.com/metadataType=dxp')
  local('kubectl delete cm -l lxc.liferay.com/metadataType=ext-init')

for tiltfile in str(local("find /workspace -name Tiltfile -not -path '*/node_modules/*' -not -path '*/node_modules_cache/*'")).splitlines():
  include(tiltfile)

#include("/workspace/extensions/coupon-action-springboot/Tiltfile")